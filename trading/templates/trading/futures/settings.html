{% extends "trading/futures/base.html" %}
{% load humanize %}

{% block content %}
<div class="container-mobile">
  <!-- í˜„ì¬ ëª©í‘œ ì§„í–‰ ìƒí™© -->
  <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-bottom: 16px;">
    <h6 style="margin-bottom: 12px; font-weight: 600; opacity: 0.9;">ğŸ¯ í˜„ì¬ ëª©í‘œ ì§„í–‰ ìƒí™©</h6>

    <div style="margin-bottom: 12px;">
      <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
        <span style="font-size: 14px; opacity: 0.9;">
          {% if goal.period == 'daily' %}ì¼ê°„ ëª©í‘œ
          {% elif goal.period == 'weekly' %}ì£¼ê°„ ëª©í‘œ
          {% elif goal.period == 'monthly' %}ì›”ê°„ ëª©í‘œ
          {% endif %}
        </span>
        <span style="font-size: 18px; font-weight: bold;">â‚©{{ current_profit|floatformat:0|intcomma }} / â‚©{{ goal.profit_goal|floatformat:0|intcomma }}</span>
      </div>

      <div style="background: rgba(255,255,255,0.3); border-radius: 12px; height: 24px; overflow: hidden;">
        <div style="background: rgba(255,255,255,0.9); height: 100%; width: {{ progress_percent }}%; transition: width 0.3s ease;"></div>
      </div>
    </div>

    <div style="display: flex; justify-content: space-between; font-size: 14px; opacity: 0.9;">
      <span>ì§„í–‰ë¥ : {{ progress_percent|floatformat:0 }}%</span>
      <span>ê±°ë˜ íšŸìˆ˜: {{ num_trades_this_week }}ê±´</span>
    </div>
  </div>

  <!-- ì„¤ì • í¼ -->
  <form method="post" action="{% url 'settings' %}">
    {% csrf_token %}

    <!-- ëª©í‘œ ì„¤ì • -->
    <div class="card" style="margin-bottom: 16px;">
      <h6 style="margin-bottom: 12px; font-weight: 600;">ğŸ’° ëª©í‘œ ì„¤ì •</h6>

      <div style="margin-bottom: 12px;">
        <label style="display: block; font-size: 13px; color: #757575; margin-bottom: 4px;">ëª©í‘œ ê¸°ê°„</label>
        <select name="period" class="form-select form-select-sm" style="border-radius: 8px;">
          <option value="daily" {% if goal.period == 'daily' %}selected{% endif %}>ì¼ê°„</option>
          <option value="weekly" {% if goal.period == 'weekly' %}selected{% endif %}>ì£¼ê°„</option>
          <option value="monthly" {% if goal.period == 'monthly' %}selected{% endif %}>ì›”ê°„</option>
        </select>
      </div>

      <div style="margin-bottom: 12px;">
        <label style="display: block; font-size: 13px; color: #757575; margin-bottom: 4px;">ìˆ˜ìµ ëª©í‘œ (â‚©)</label>
        <input type="number" name="profit_goal" class="form-control form-control-sm"
               value="{{ goal.profit_goal|floatformat:0 }}"
               step="100" min="0"
               style="border-radius: 8px;">
      </div>

      <div style="margin-bottom: 0;">
        <label style="display: block; font-size: 13px; color: #757575; margin-bottom: 4px;">ìµœëŒ€ ì†ì‹¤ í•œë„ (â‚©)</label>
        <input type="number" name="max_loss_limit" class="form-control form-control-sm"
               value="{{ goal.max_loss_limit|floatformat:0 }}"
               step="100" min="0"
               style="border-radius: 8px;">
        <div style="font-size: 11px; color: #757575; margin-top: 4px;">
          ì´ í•œë„ë¥¼ ì´ˆê³¼í•˜ë©´ ê±°ë˜ë¥¼ ì¤‘ë‹¨í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.
        </div>
      </div>
    </div>

    <!-- ê±°ë˜ ì œí•œ -->
    <div class="card" style="margin-bottom: 16px;">
      <h6 style="margin-bottom: 12px; font-weight: 600;">ğŸš¦ ê±°ë˜ ì œí•œ</h6>

      <div style="margin-bottom: 0;">
        <label style="display: block; font-size: 13px; color: #757575; margin-bottom: 4px;">ì¼ì¼ ìµœëŒ€ ê±°ë˜ íšŸìˆ˜</label>
        <input type="number" name="max_trades_per_day" class="form-control form-control-sm"
               value="{{ goal.max_trades_per_day }}"
               min="1" max="50"
               style="border-radius: 8px;">
        <div style="font-size: 11px; color: #757575; margin-top: 4px;">
          ê³¼ë„í•œ ê±°ë˜ë¥¼ ë°©ì§€í•˜ê³  ì‹ ì¤‘í•œ ì§„ì…ì„ ìœ ë„í•©ë‹ˆë‹¤.
        </div>
      </div>
    </div>

    <!-- ì•Œë¦¼ ì„¤ì • -->
    <div class="card" style="margin-bottom: 16px;">
      <h6 style="margin-bottom: 12px; font-weight: 600;">ğŸ”” ì•Œë¦¼ ì„¤ì •</h6>

      <div style="margin-bottom: 12px;">
        <label style="display: block; font-size: 13px; color: #757575; margin-bottom: 4px;">ì—°ì† ì†ì‹¤ ì•Œë¦¼ (íšŸìˆ˜)</label>
        <input type="number" name="alert_consecutive_losses" class="form-control form-control-sm"
               value="{{ goal.alert_consecutive_losses }}"
               min="2" max="10"
               style="border-radius: 8px;">
        <div style="font-size: 11px; color: #757575; margin-top: 4px;">
          ì´ íšŸìˆ˜ë§Œí¼ ì—°ì† ì†ì‹¤ì´ ë°œìƒí•˜ë©´ ì•Œë¦¼ì„ í‘œì‹œí•©ë‹ˆë‹¤.
        </div>
      </div>

      <div style="margin-bottom: 0;">
        <label style="display: block; font-size: 13px; color: #757575; margin-bottom: 4px;">ë‚®ì€ ìŠ¹ë¥  ì•Œë¦¼ ê¸°ì¤€ (%)</label>
        <input type="number" name="alert_low_win_rate" class="form-control form-control-sm"
               value="{{ goal.alert_low_win_rate|floatformat:0 }}"
               min="0" max="100" step="5"
               style="border-radius: 8px;">
        <div style="font-size: 11px; color: #757575; margin-top: 4px;">
          ìµœê·¼ ê±°ë˜ì˜ ìŠ¹ë¥ ì´ ì´ ê¸°ì¤€ ì´í•˜ë¡œ ë–¨ì–´ì§€ë©´ ì•Œë¦¼ì„ í‘œì‹œí•©ë‹ˆë‹¤.
        </div>
      </div>
    </div>

    <!-- ì €ì¥ ë²„íŠ¼ -->
    <button type="submit" class="btn btn-primary w-100" style="padding: 14px; border-radius: 8px; font-weight: 600;">
      ì €ì¥í•˜ê¸°
    </button>
  </form>

  <!-- ë„ì›€ë§ -->
  <div class="card" style="margin-top: 16px; margin-bottom: 16px; background: #f5f5f5; border: none;">
    <h6 style="margin-bottom: 8px; font-weight: 600; font-size: 14px;">ğŸ’¡ ì„¤ì • ê°€ì´ë“œ</h6>
    <ul style="margin: 0; padding-left: 20px; font-size: 12px; line-height: 1.8; color: #616161;">
      <li><strong>ìˆ˜ìµ ëª©í‘œ:</strong> í˜„ì‹¤ì ì´ê³  ë‹¬ì„± ê°€ëŠ¥í•œ ëª©í‘œë¥¼ ì„¤ì •í•˜ì„¸ìš”.</li>
      <li><strong>ì†ì‹¤ í•œë„:</strong> ê³„ì¢Œ ì”ê³ ì˜ 2-5%ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.</li>
      <li><strong>ê±°ë˜ íšŸìˆ˜:</strong> í’ˆì§ˆ ìˆëŠ” ì§„ì…ì„ ìœ„í•´ ì œí•œì„ ë‘ì„¸ìš”.</li>
      <li><strong>ì—°ì† ì†ì‹¤:</strong> 3-5íšŒ ì„¤ì •ì„ ê¶Œì¥í•©ë‹ˆë‹¤.</li>
      <li><strong>ìŠ¹ë¥  ê¸°ì¤€:</strong> 40% ì´í•˜ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.</li>
    </ul>
  </div>

  <!-- ì•± ì •ë³´ -->
  <div style="text-align: center; padding: 20px; color: #757575; font-size: 12px;">
    <div style="margin-bottom: 4px;">Futures Trading Journal v1.0</div>
    <div>Made with Claude Code</div>
  </div>
</div>
{% endblock %}

{% block script %}
<script>
// í¼ ê²€ì¦
document.querySelector('form').addEventListener('submit', function(e) {
  const profitGoal = parseFloat(document.querySelector('[name="profit_goal"]').value);
  const maxLoss = parseFloat(document.querySelector('[name="max_loss_limit"]').value);

  if (profitGoal <= 0) {
    alert('ìˆ˜ìµ ëª©í‘œëŠ” 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.');
    e.preventDefault();
    return false;
  }

  if (maxLoss < 0) {
    alert('ìµœëŒ€ ì†ì‹¤ í•œë„ëŠ” 0 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
    e.preventDefault();
    return false;
  }

  return true;
});
</script>
{% endblock %}
