{% extends "trading/futures/base.html" %}
{% load humanize %}

{% block content %}
<div class="container-mobile">
  {% if no_data %}
  <!-- ë°ì´í„° ì—†ìŒ -->
  <div class="empty-state">
    <p>ìµœê·¼ 30ì¼ê°„ ê±°ë˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</p>
    <p style="font-size: 12px; margin-top: 8px;">ê±°ë˜ë¥¼ ì§„í–‰í•œ í›„ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”</p>
  </div>
  {% else %}

  <!-- ì•Œë¦¼/ê²½ê³  -->
  {% if alerts %}
  {% for alert in alerts %}
  <div class="alert-card {% if alert.level == 'high' %}high{% else %}medium{% endif %}" style="margin-bottom: 16px;">
    <strong>âš ï¸ ì£¼ì˜</strong>
    <p style="margin: 8px 0 0 0;">{{ alert.message }}</p>
  </div>
  {% endfor %}
  {% endif %}

  <!-- ìƒí’ˆë³„ ì„±ê³¼ -->
  {% if instrument_stats %}
  <div class="card" style="margin-bottom: 16px;">
    <h6 style="margin-bottom: 12px; font-weight: 600;">ğŸ“¦ ìƒí’ˆë³„ ì„±ê³¼ (Top 5)</h6>
    {% for stat in instrument_stats %}
    <div style="padding: 10px 0; {% if not forloop.last %}border-bottom: 1px solid #f0f0f0;{% endif %}">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
        <div>
          <span style="font-weight: 600;">{{ stat.instrument__symbol }}</span>
          <span style="color: #757575; font-size: 12px; margin-left: 8px;">{{ stat.num_trades }}ê±´</span>
        </div>
        <div style="font-weight: bold; {% if stat.total_profit > 0 %}color: #d32f2f;{% else %}color: #1976d2;{% endif %}">
          {% if stat.total_profit > 0 %}+{% endif %}â‚©{{ stat.total_profit|floatformat:0|intcomma }}
        </div>
      </div>
      <div style="display: flex; align-items: center; gap: 8px;">
        <div style="flex: 1; background: #f0f0f0; border-radius: 8px; height: 6px; overflow: hidden;">
          <div style="background: {% if stat.win_rate >= 50 %}#4CAF50{% else %}#FF9800{% endif %}; height: 100%; width: {{ stat.win_rate }}%;"></div>
        </div>
        <span style="font-size: 12px; color: #757575;">{{ stat.win_rate|floatformat:0 }}%</span>
      </div>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- ì‹œê°„ëŒ€ë³„ ë¶„ì„ -->
  {% if hour_stats %}
  <div class="card" style="margin-bottom: 16px;">
    <h6 style="margin-bottom: 12px; font-weight: 600;">ğŸ• ë² ìŠ¤íŠ¸ ê±°ë˜ ì‹œê°„ëŒ€</h6>
    <div style="font-size: 12px; color: #757575; margin-bottom: 8px;">
      ìŠ¹ë¥ ì´ ë†’ì€ ì‹œê°„ëŒ€ Top 5
    </div>
    {% for stat in hour_stats %}
    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; margin-bottom: 6px; background: #f5f5f5; border-radius: 8px;">
      <div>
        <span style="font-weight: 600;">{{ stat.hour }}:00</span>
        <span style="color: #757575; font-size: 12px; margin-left: 8px;">{{ stat.num_trades }}ê±´</span>
      </div>
      <div style="display: flex; align-items: center; gap: 8px;">
        <span style="font-size: 12px; color: #757575;">ìŠ¹ë¥ </span>
        <span style="font-weight: bold; color: {% if stat.win_rate >= 50 %}#4CAF50{% else %}#FF9800{% endif %};">
          {{ stat.win_rate|floatformat:0 }}%
        </span>
      </div>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- íƒ€ì„í”„ë ˆì„ë³„ ì„±ê³¼ -->
  {% if timeframe_stats %}
  <div class="card" style="margin-bottom: 16px;">
    <h6 style="margin-bottom: 12px; font-weight: 600;">â±ï¸ íƒ€ì„í”„ë ˆì„ë³„ ì„±ê³¼</h6>
    {% for stat in timeframe_stats %}
    <div style="padding: 10px 0; {% if not forloop.last %}border-bottom: 1px solid #f0f0f0;{% endif %}">
      <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
        <div>
          <span style="font-weight: 600; text-transform: capitalize;">
            {% if stat.timeframe == 'scalping' %}ìŠ¤ìº˜í•‘
            {% elif stat.timeframe == 'day' %}ë°ì´ íŠ¸ë ˆì´ë”©
            {% elif stat.timeframe == 'swing' %}ìŠ¤ìœ™
            {% elif stat.timeframe == 'longterm' %}ì¥ê¸°
            {% else %}{{ stat.timeframe }}{% endif %}
          </span>
          <span style="color: #757575; font-size: 12px; margin-left: 8px;">{{ stat.num_trades }}ê±´</span>
        </div>
        <div style="font-weight: bold; {% if stat.total_profit > 0 %}color: #d32f2f;{% else %}color: #1976d2;{% endif %}">
          {% if stat.total_profit > 0 %}+{% endif %}â‚©{{ stat.total_profit|floatformat:0|intcomma }}
        </div>
      </div>
      <div style="display: flex; gap: 16px; font-size: 12px; color: #757575;">
        <span>ìŠ¹ë¥ : <strong>{{ stat.win_rate|floatformat:0 }}%</strong></span>
        <span>í‰ê· : <strong>â‚©{{ stat.avg_profit|floatformat:0|intcomma }}</strong></span>
      </div>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- ì „ëµë³„ ì„±ê³¼ -->
  {% if strategy_stats %}
  <div class="card" style="margin-bottom: 16px;">
    <h6 style="margin-bottom: 12px; font-weight: 600;">ğŸ² ì „ëµë³„ ì„±ê³¼ (Top 5)</h6>
    {% for stat in strategy_stats %}
    <div style="padding: 10px 0; {% if not forloop.last %}border-bottom: 1px solid #f0f0f0;{% endif %}">
      <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
        <div>
          <span style="font-weight: 600;">{{ stat.entry_strategy__name }}</span>
          <span style="color: #757575; font-size: 12px; margin-left: 8px;">{{ stat.num_trades }}ê±´</span>
        </div>
        <div style="font-weight: bold; {% if stat.total_profit > 0 %}color: #d32f2f;{% else %}color: #1976d2;{% endif %}">
          {% if stat.total_profit > 0 %}+{% endif %}â‚©{{ stat.total_profit|floatformat:0|intcomma }}
        </div>
      </div>
      <div style="font-size: 12px; color: #757575;">
        ìŠ¹ë¥ : <strong>{{ stat.win_rate|floatformat:0 }}%</strong>
      </div>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- ìœ„í—˜ ì§€í‘œ -->
  {% if avg_win %}
  <div class="card" style="margin-bottom: 16px;">
    <h6 style="margin-bottom: 12px; font-weight: 600;">âš–ï¸ ìœ„í—˜ ì§€í‘œ</h6>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
      <div style="background: #ffebee; padding: 12px; border-radius: 8px;">
        <div style="font-size: 11px; color: #757575; margin-bottom: 4px;">í‰ê·  ìˆ˜ìµ</div>
        <div style="font-size: 20px; font-weight: bold; color: #d32f2f;">â‚©{{ avg_win|floatformat:0|intcomma }}</div>
      </div>
      <div style="background: #e3f2fd; padding: 12px; border-radius: 8px;">
        <div style="font-size: 11px; color: #757575; margin-bottom: 4px;">í‰ê·  ì†ì‹¤</div>
        <div style="font-size: 20px; font-weight: bold; color: #1976d2;">â‚©{{ avg_loss|floatformat:0|intcomma }}</div>
      </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
      <div style="background: #f5f5f5; padding: 12px; border-radius: 8px;">
        <div style="font-size: 11px; color: #757575; margin-bottom: 4px;">ìµœëŒ€ ìˆ˜ìµ</div>
        <div style="font-size: 18px; font-weight: bold; color: #333;">â‚©{{ largest_win|floatformat:0|intcomma }}</div>
      </div>
      <div style="background: #f5f5f5; padding: 12px; border-radius: 8px;">
        <div style="font-size: 11px; color: #757575; margin-bottom: 4px;">ìµœëŒ€ ì†ì‹¤</div>
        <div style="font-size: 18px; font-weight: bold; color: #333;">â‚©{{ largest_loss|floatformat:0|intcomma }}</div>
      </div>
    </div>

    <div style="margin-top: 12px; padding: 12px; background: {% if pnl_ratio >= 1.5 %}#e8f5e9{% else %}#fff3cd{% endif %}; border-radius: 8px;">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <span style="font-size: 12px; color: #616161;">ì†ìµë¹„ (PnL Ratio)</span>
        <span style="font-size: 24px; font-weight: bold; color: {% if pnl_ratio >= 1.5 %}#4CAF50{% else %}#FF9800{% endif %};">
          {{ pnl_ratio|floatformat:2 }}:1
        </span>
      </div>
      <div style="margin-top: 8px; font-size: 11px; color: #616161;">
        {% if pnl_ratio >= 2 %}
        âœ… í›Œë¥­í•©ë‹ˆë‹¤! ì†ìµë¹„ê°€ ë§¤ìš° ì¢‹ìŠµë‹ˆë‹¤.
        {% elif pnl_ratio >= 1.5 %}
        ğŸ‘ ì–‘í˜¸í•©ë‹ˆë‹¤. ì†ìµë¹„ê°€ ì¢‹ì€ í¸ì…ë‹ˆë‹¤.
        {% else %}
        âš ï¸ ì†ìµë¹„ê°€ ë‚®ìŠµë‹ˆë‹¤. ì†ì ˆì„ ë” ë¹¨ë¦¬ í•˜ê±°ë‚˜ ìˆ˜ìµ ëª©í‘œë¥¼ ë†’ì´ì„¸ìš”.
        {% endif %}
      </div>
    </div>
  </div>
  {% endif %}

  <!-- ê°œì„  ì œì•ˆ -->
  <div class="card" style="margin-bottom: 16px;">
    <h6 style="margin-bottom: 12px; font-weight: 600;">ğŸ’¬ ê°œì„  ì œì•ˆ</h6>
    <ul style="margin: 0; padding-left: 20px; font-size: 13px; line-height: 1.8; color: #616161;">
      {% if pnl_ratio < 1.5 %}
      <li>ì†ìµë¹„ê°€ ë‚®ìŠµë‹ˆë‹¤. ì†ì ˆì„ ë” ë¹¨ë¦¬ ì‹¤í–‰í•˜ê±°ë‚˜ ì´ìµ ëª©í‘œë¥¼ ë†’ì´ì„¸ìš”.</li>
      {% endif %}
      {% if instrument_stats.0.win_rate < 45 %}
      <li>ì£¼ìš” ê±°ë˜ ìƒí’ˆì˜ ìŠ¹ë¥ ì´ ë‚®ìŠµë‹ˆë‹¤. ìƒí’ˆ íŠ¹ì„±ì„ ë‹¤ì‹œ ê³µë¶€í•´ë³´ì„¸ìš”.</li>
      {% endif %}
      {% if not strategy_stats %}
      <li>ì§„ì… ì „ëµì„ ê¸°ë¡í•˜ë©´ ë” ì •í™•í•œ ë¶„ì„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
      {% endif %}
      {% if pnl_ratio >= 1.5 %}
      <li>í˜„ì¬ íŠ¸ë ˆì´ë”©ì´ ì˜ ë˜ê³  ìˆìŠµë‹ˆë‹¤! ì¼ê´€ì„±ì„ ìœ ì§€í•˜ì„¸ìš”.</li>
      {% endif %}
    </ul>
  </div>

  {% endif %}
</div>
{% endblock %}

{% block script %}
<script>
// í˜ì´ì§€ ë¡œë“œ ì‹œ ì• ë‹ˆë©”ì´ì…˜ (ì„ íƒì‚¬í•­)
document.addEventListener('DOMContentLoaded', function() {
  console.log('Insights page loaded');
});
</script>
{% endblock %}
